pipeline {
    agent any
    
    environment {
        PROJECT_ID='peak-axiom-426310-b1'
        CLIENT_EMAIL='jenkins-vm-controller@peak-axiom-426310-b1.iam.gserviceaccount.com'
        GCLOUD_CREDS=credentials('GCP-service-key')
        CLUSTER_NAME = 'autopilot-cluster-1'
        CLUSTER_ZONE = 'us-central1'
      }
stages {    
    stage('Deploy to GKE') {
            steps {
                script {
                        sh '''
                            gcloud auth activate-service-account --key-file="$GCLOUD_CREDS" 
                            gcloud config set project $PROJECT_ID
                            gcloud config set compute/zone $CLUSTER_ZONE
                            gcloud container clusters get-credentials $CLUSTER_NAME
                            kubectl apply -f deployment.yaml
                        '''
                }
            }
        }
    }
     post {
            always {
                 cleanWs()
            }
        }  
}
